# -------------------------------------------------------------------
# Kolla-Ansible global configuration
# Cloud Infrastructure – OpenStack (LAB)
# Ubuntu 20.04 LTS focal | OpenStack Bobcat (2023.2)
# Ubuntu 22.04 LTS jammy | OpenStack Coyote (2024.2)
# Single NIC per node
# -------------------------------------------------------------------

# ------------------------------------------------
# BASE
# ------------------------------------------------

# ------------------------------------------------
# CONTAINER RUNTIME
# ------------------------------------------------
#docker_registry: "quay.io"
#docker_namespace: "openstack.kolla"
docker_registry: ""
docker_namespace: "kolla"

kolla_base_distro: "ubuntu"
kolla_install_type: "binary" # Puede ser "source" para código fuente
openstack_release: "2024.2"
openstack_tag: "2024.2-ubuntu-noble"
kolla_tag: "2024.2-ubuntu-noble"
kolla_ansible_branch: stable/2024.2


# Contenedor engine: docker o podman
kolla_container_engine: "docker"

# ------------------------------------------------
# HIGH AVAILABILITY
# ------------------------------------------------
kolla_internal_vip_address: "50.50.1.100"
kolla_external_vip_address: "50.50.1.101"
kolla_external_fqdn: "openstack.local"

enable_haproxy: true
enable_keepalived: true
kolla_enable_haproxy: true

# Servicios que HAProxy debe exponer
haproxy_enabled_services:
  - keystone
  - glance-api
  - horizon
  - nova-api
  - nova-scheduler
  - cinder-api
  - cinder-scheduler
  - neutron-server          # opcional si quieres HA para Neutron
  - placement-api           # opcional si quieres HA para Placement

# ------------------------------------------------
# NETWORKING (Single NIC LAB)
# ------------------------------------------------
network_interface: "eth0"
tunnel_interface: "eth0"
neutron_external_interface: "eth0"
enable_neutron_provider_networks: true

# ------------------------------------------------
# NEUTRON / OVN
# ------------------------------------------------
neutron_plugin_agent: "ovn"
enable_openvswitch: true
enable_ovn: true
neutron_enable_ovn_agent: true
neutron_ovn_distributed_fip: true
enable_ovn_controller: true

# OVN LAB settings
ovn_use_veth: true        # usar veth en lugar de aceleración por hardware
ovs_dpdk_enabled: false   # deshabilitar DPDK para laboratorio

ovn_controller_network:
  network_interface: "eth0"
  bridge: "br-ctlplane"
  mtu: 1500


# ------------------------------------------------
# CORE SERVICES
# ------------------------------------------------
enable_keystone: true
enable_glance: true
enable_nova: true
enable_neutron: true
enable_horizon: true
enable_placement: true

# ------------------------------------------------
# CINDER SERVICES (Deshabilitado)
# ------------------------------------------------
enable_cinder: false
enable_cinder_api: false
enable_cinder_scheduler: false
enable_cinder_volume: false
enable_cinder_backup: false
enable_cinder_backend_lvm: false

# ------------------------------------------------
# SERVICES DISABLED (LAB)
# ------------------------------------------------
enable_heat: false
enable_barbican: false
enable_swift: false
enable_octavia: false

# ------------------------------------------------
# SECURITY (LAB)
# ------------------------------------------------
enable_tls_internal: false
enable_tls_external: false

# ------------------------------------------------
# LOGGING
# ------------------------------------------------
enable_fluentd: false

# ------------------------------------------------
# NOVA (LAB CONFIG)
# ------------------------------------------------
#nova_compute_virt_type: "kvm"
nova_compute_virt_type: "qemu"  # usar qemu para laboratorio sin VT-x

# Deshabilitar proxies y serial para laboratorio
enable_nova_novncproxy: false
enable_nova_spicehtml5proxy: false
enable_nova_serialproxy: false
enable_nova_conductor: true
enable_nova_compute_ironic: false
enable_ironic_neutron_agent: false

enable_neutron_bgp_dragent: false
enable_neutron_infoblox_ipam_agent: false
enable_neutron_metering: false

# ------------------------------------------------
# MESSAGING (RABBITMQ)
# ------------------------------------------------
enable_rabbitmq: true
enable_rabbitmq_cluster: true
rabbitmq_user: openstack
rabbitmq_cluster_cookie: "hXhYB1jRKj27ea8hNkGVGmTPq7qDUMxcZSSeI4Oo" # Obtener de /etc/kolla/passwords.yml in variable rabbitmq_cluster_cookie"
rabbitmq_virtual_hosts:
  - /
  - /nova

rabbitmq_policies:
  - name: ha-all
    pattern: ".*"
    definition:
      ha-mode: all
      ha-sync-mode: automatic

# Management UI
enable_rabbitmq_management: true

# ------------------------------------------------
# Memcached (opcional para Keystone y otros)
# ------------------------------------------------
enable_memcached: true
memcached_servers:
  - "ctrl01:11211"
  - "ctrl02:11211"
  - "ctrl03:11211"

# -------------------------------
# MariaDB / Galera
# -------------------------------
enable_mariadb: true
mariadb_port: 3306
mariadb_wsrep_port: 4567
mariadb_ist_port: 4568
mariadb_sst_port: 4444
mariadb_cluster_name: "openstack"
mariadb_sst_method: "mariabackup"
enable_proxysql: true
#database_address: "{{ kolla_internal_vip_address }}"
#database_port: 6032   # puerto de Proxysql